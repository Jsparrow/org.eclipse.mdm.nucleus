<!-- *******************************************************************************
  * Copyright (c) 2016 Gigatronik Ingolstadt GmbH
  * All rights reserved. This program and the accompanying materials
  * are made available under the terms of the Eclipse Public License v1.0
  * which accompanies this distribution, and is available at
  * http://www.eclipse.org/legal/epl-v10.html
  *
  * Contributors:
  * Dennis Schroeder - initial implementation
  ******************************************************************************* -->
<style>
:host /deep/ .dropdown {
  width: 200px;
}
:host /deep/ .dropdown-toggle {
    overflow: hidden;
    padding-right: 24px /* Optional for caret */;
    text-align: left;
    text-overflow: ellipsis;
    width: 100%;
}

/* Optional for caret */
:host /deep/ .dropdown-toggle .caret {
    position: absolute;
    right: 12px;
    top: calc(50% - 2px);
}
</style>

<form class="form-inline" style="margin-bottom: 10px;">
  <div class="form-group">
    <label for="search-source" class="control-label">Filter</label>
    <div class="btn-group" dropdown>
      <button id="search-source" type="button" class="btn btn-default dropdown-toggle" dropdownToggle aria-haspopup="true" aria-expanded="false">
        {{currentFilter.name}} <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" dropdownMenu>
        <li *ngFor="let filter of filters">
          <a class="dropdown-item" (click)="selectFilter(filter)">{{filter.name}}</a>
        </li>
      </ul>
    </div>
  </div>
  <div class="form-group">
    <label for="search-source" class="control-label">Quelle</label>
    <dropdown-multiselect name="envs" [dropdownConfig]="dropdownConfig" [(ngModel)]="dropdownModel" (ngModelChange)="selectedEnvironmentsChanged($event)"></dropdown-multiselect>
  </div>
  <div class="form-group">
    <label for="search-resulttype" class="control-label">Ergebnistyp</label>
    <div class="btn-group" dropdown>
      <button id="search-resulttype" type="button" class="btn btn-default dropdown-toggle" dropdownToggle aria-haspopup="true" aria-expanded="false">
      {{getSearchDefinition(currentFilter.resultType)?.label}} <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" dropdownMenu>
        <li *ngFor="let def of definitions" role="menuitem">
          <a class="dropdown-item" (click)="selectResultType(def)">{{def.label}}</a>
        </li>
      </ul>
    </div>
  </div>
  <div class="form-group">
    <input type="text" class="form-control" name="searchText" placeholder="Suchtext eingeben" [(ngModel)]="currentFilter.fulltextQuery" (keyup.enter)="onSearch()" aria-describedby="basic-addon1">
  </div>
  <div class="form-group">
    <button type="button" class="btn btn-default" (click)="onSearch()">Suchen</button>
  </div>
</form>

<accordion>
  <accordion-group [isOpen]="true" t="isAdvancedSearchOpen" #advancedSearch>
    <div accordion-heading>Advanced search
      <span class="pull-right glyphicon"[ngClass]="{'glyphicon-chevron-down': advancedSearch?.isOpen, 'glyphicon-chevron-right': !advancedSearch?.isOpen}"></span>
    </div>
    <div class="container-fluid">
      <div class="row" style="margin-top: 5px; margin-bottom: 5px;">
        <div class="col-xs-6">
          <button id="filter-add" type="button" class="btn btn-default" (click)="showSearchFieldsEditor()"><span class="glyphicon glyphicon-plus"></span></button>
          <button id="filter-add" type="button" class="btn btn-default" (click)="showSearchFieldsEditor(currentFilter)"><span class="glyphicon glyphicon-edit"></span></button>
        </div>
        <div class="col-xs-6" style="text-align: right;">
          <button type="button" class="btn btn-default" (click)="showSaveModal()" title="Save search filter"><span class="glyphicon glyphicon-floppy-disk"></span></button>
          <button type="button" class="btn btn-default" (click)="resetConditions()" title="Reset search conditions"><span class="glyphicon glyphicon-erase"></span></button>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div *ngFor="let env of layout.getEnvironments()">
            <div *ngIf="layout.getConditions(env).length > 0">
              <span  style="font-weight: bold;">{{env}}</span>
              <table class="table table-bordered searchdefinition">
                <colgroup>
                  <col style="width: 17%;">
                  <col style="width: 17%;">
                  <col style="width: 5%;">
                  <col style="width: 58%;">
                  <col style="width: 3%;">
                </colgroup>
                <tr search-condition class="condition"
                  *ngFor="let condition of layout.getConditions(env)"
                  [env]="env"
                  [condition]="condition"
                  (onRemove)="removeCondition($event)">
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </accordion-group>
  <accordion-group [isOpen]="isSearchResultsOpen" #searchResults>
    <div accordion-heading>
      Ergebnisse
      <span class="pull-right glyphicon"[ngClass]="{'glyphicon-chevron-down': searchResults?.isOpen, 'glyphicon-chevron-right': !searchResults?.isOpen}"></span>
    </div>
    <div class="container-fluid">
      <div class="row" style="margin-top: 5px; margin-bottom: 5px;">
        <div class="col-md-6">
          <mdm-view></mdm-view>
        </div>
        <div class="col-md-6" style="text-align: right;">
          <button type="button" class="btn btn-default" title="Selection to basket" (click)="selected2Basket()">
            <span class="glyphicon glyphicon-shopping-cart" style="color:#DADADA; margin-right: -12px;"></span>
            <span class="glyphicon glyphicon-shopping-cart" style="color:#A8A4A4; margin-right: -12px;"></span>
            <span class="glyphicon glyphicon-shopping-cart"></span>
          </button>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12" style="max-width: 100%; overflow: auto;">
          <mdm-tableview [results]="results" [view]="viewComponent.selectedView" isShopable="true" [menuItems]="contextMenuItems"></mdm-tableview>
        </div>
      </div>
    </div>
  </accordion-group>
</accordion>

<div bsModal #lgSaveModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="SelectSearchComponents" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" (click)="childSaveModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">Filter speichern als:</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <div class="row">
            <input type="text" class="form-control" placeholder="Filter-Name" [value]="filterName" (input) = "filterName = $event.target.value" (keyup.enter)="saveFilter()">
          </div>
          <div class="row" style="margin-top: 10px;">
            <div class="col-md-12">
              <form class="form-inline">
                <button type="button" class="btn btn-default pull-right" (click)="saveFilter()" [disabled]="!filterName" title="{{filterName? '' : 'Name nicht gesetzt!'}}">
                  <span class="glyphicon glyphicon-floppy-disk"></span> Speichern
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<edit-searchFields [searchableFields]="searchableFields" [environments]="environments"></edit-searchFields>
